#!/usr/bin/env python3

import heapq


# Generated by 2.12.0 https://github.com/kyuridenamida/atcoder-tools  (tips: You use the default template now. You can remove this line by using your custom template)
def main():
    N, Q = map(int, input().split())

    q_list = [list(map(int, input().split())) for _ in range(Q)]

    standby_que = list(range(Q))
    ready_que = []

    done_set = set()
    ans_list = []

    for i, q in enumerate(q_list):
        if q[0] == 1:
            call = heapq.heappop(standby_que)
            heapq.heappush(ready_que, call)
        elif q[0] == 2:
            pop_value = q[1] - 1
            done_set.add(pop_value)
        else:
            while True:
                call = heapq.heappop(ready_que)
                if call not in done_set:
                    break
            heapq.heappush(ready_que, call)
            if call < float("INF"):
                ans_list.append(call)


    for ans in ans_list:
        print(ans + 1)


if __name__ == '__main__':
    main()
